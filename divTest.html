<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webapp Layout Test</title>
    <link rel="stylesheet" href="external/css/foundation.css" />

    <style>
    .menu-bar {
        height:20px;
        background:lightgrey;
    }

    .container {
        flex: 1;
        display: flex;
    }

    .column-items {
        flex-direction: column;
    }

    .row-items {
        flex-direction: row;
    }

    .border-style {
        border: gainsboro;
        border-width: thin;
        border-style: solid;
        padding: 10px;
        margin: 10px;
        box-shadow: 2px 2px 2px #909090;
        border-radius: 5px;
    }

    #outer {
        display:flex;
        flex-direction:column;
    }

    #main {
        bottom: 0px;
        top: 0px;
        left: 0px;
        right: 0px;
        position: relative;
        flex: 1;
        display: flex;
    }

    #outer {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .ctxMenu{
        display:none;
        z-index:100;
    }

    .ctx-menu {
        position:absolute;
        display:block;
        left:0px;
        top:0px;
        height:20px;
        width:20px;
        padding:0;
        margin:0;
        border:1px solid;
        background-color:white;
        font-weight:normal;
        white-space:nowrap;
    }
    .ctx-menu:hover{
        background-color:#eef;
        font-weight:bold;
    }
    .ctx-menu:hover > menu{
        display:block;
    }
    .ctx-menu > menu{
        display:none;
        position:relative;
        top:-20px;
        left:100%;
        width:140px;
    }
    .ctx-menu[title]:before{
        content:attr(title);
    }
    .ctx-menu:not([title]):before{
        content:"\2630";
    }
    </style>
</head>
<body>
    <script src='external/jquery-3.1.1.js' />
    <script src="external/js/vendor/what-input.min.js"></script>
    <script src="external/js/vendor/foundation.min.js"></script>

    <div id='outer'>
        <div id='top-menu' class='menu-bar'>
            <menu title='top-menu'>
                <menu title='file'></menu>
                <menu title='edit layout'></menu>
            </menu>
        </div>
            <div id="main" class='border-style column-items'>
            main
            </div>
        <div id='status-bar' class='menu-bar'> 
        # ...
        </div>
    </div>

    <script>
        NELEMENTS = 0;
        var main = $("#main")[0];
        make_menu(main, 'main');
        main.addEventListener("contextmenu", show_menu, false);
        main.addEventListener("click", clear_menu, false);

        function make_menu(elem, number){
            var menu = '';
            menu += '\
            <menu class="ctx-menu ctxMenu" style="display:none" id="ctxMenu' + number + '"> \
            <menu title="Add Container" class="ctx-menu" onclick="addContainer(this)"> \
            </menu> '
            if (number != 'main'){
                menu += '<menu title="Remove Container" class="ctx-menu" onclick="removeContainer(this)"> \
                </menu>'
            }
            menu += '<menu title="Align" class="ctx-menu"> \
                         <menu title="Vertical" class="ctx-menu"  onclick="alignVertical(this)"> </menu>  \
                         <menu title="Horizontal" class="ctx-menu" onclick="alignHorizontal(this)"></menu> \
                </menu> \
            </menu>'
            elem.innerHTML += menu;
        }

        function show_menu(event){
            var number = event.target.id;
            clear_menu();
            event.stopPropagation();
            event.preventDefault();
            var ctxMenu = $("#ctxMenu" + number)[0];
            ctxMenu.style.display = "block";
            ctxMenu.style.left = (event.pageX - 10)+"px";
            ctxMenu.style.top = (event.pageY - 10)+"px";
        };

        function clear_menu(){
            var ctxMenus = $(".ctxMenu");
            for (i=0; i < ctxMenus.length; i++){
                ctxMenus[i].style.display = "none";
                ctxMenus[i].style.left = "";
                ctxMenus[i].style.top = "";    
            }

        };

        function removeContainer(elem){
            //parentElement = $(this).parent('div')
            parentElem = elem.parentElement.parentElement
            if (parentElem.id != 'main'){
                parentElem.remove();
            }
        }

        function addContainer(elem){
            console.log('addContainer');
            parentElem = elem.parentElement.parentElement;
            div = document.createElement('div');
            div.className = 'container border-style row-items';
            parentElem.appendChild(div);
            div.id = NELEMENTS + 1;
            div.innerHTML = NELEMENTS + 1;
            NELEMENTS += 1;
            make_menu(div, div.id);
            div.addEventListener("contextmenu", show_menu, false);
            div.addEventListener("click", clear_menu, false);
        }

        function alignVertical(melem){
            elem = melem.parentElement.parentElement.parentElement;
            elem.classList.remove("row-items")
            elem.classList.add("column-items")
        }
        function alignHorizontal(melem){
            elem = melem.parentElement.parentElement.parentElement;
            elem.classList.remove("column-items")
            elem.classList.add("row-items")
        }

    </script>
</body>
</html>

